<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>날씨앱</title>
    <style>
        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
        }

        header {
            width: 100%;
            height: 10vh;
            background-color: wheat;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .title {
            display: flex;
            align-items: center;
            justify-content: center;
            padding-left: 1vh;
        }

        .wrapper-select {
            padding-right: 1vh;
        }

        select {
            width: 150px;
            height: 35px;
            background-size: 20px;
            padding: 5px 30px 5px 10px;
            border-radius: 4px;
            outline: 0 none;
            cursor: pointer;
        }

        select option {
            padding: 3px 0;
        }

        .wrapper-container {
            display: flex;
            align-items: center;
            justify-content: center;
            padding-top: 1vh;
        }

        .container {
            width: 100%;
            height: 70vh;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 10px;
        }

        .container .more-info {
            display: flex;
            gap: 30px;
        }

        .more-info .info {
            font-size: 17px;
            font-weight: 500;
        }

        .container .temp {
            font-size: 30px;
        }

        .container .location {
            font-size: 19px;
            font-weight: 500;
        }

        .container img {
            border-radius: 10px;
        }
    </style>
</head>

<body>
    <header>
        <div class="title">
            <h1>날씨앱</h1>
        </div>
        <div class="wrapper-select">
            <select name="" id="sid" onchange="ChangeSelect(this)">
                <option value="#">선택</option>
                <option value="ToKyo">도쿄</option>
                <option value="Seoul">서울</option>
                <option value="Busan">부산</option>
                <option value="Osaka">오사카</option>
                <option value="London">런던</option>
                <option value="Dubai">두바이</option>
            </select>
        </div>
    </header>
    <div class="wrapper-container">
        <div class="container">
            <p class="location">선택된 지역 없음</p>
            <h2 class="temp">?°C 도</h2>
            <img src="https://play-lh.googleusercontent.com/Y7-aJkenjEhNkdnJgtGcIKjj332vdvgTVozjG7tx2uXJC-9IOJKo7c_WB6qD9JcgCBk"
                alt="" id="imgid" width="200" height="200" />
            <div class="more-info">
                <p class="info">풍속 ? m/s</p>
                <p class="info">습도 ?%</p>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = "ee67a9c65b516f0ee2fe7bb3df8a17cf"; // 실무에선 env 파일에 보관하는게 더 안전합니다
        const selectAll = document.getElementById("sid");
        /* 여기는 HTML에서 값을 가져와주는 ChangeSelect 함수가 있는곳입니다. */

        function ChangeSelect(e) {
            const selectedOption = e.options[e.selectedIndex];
            const selectedText = selectedOption.text;
            const selectedValue = selectedOption.value;

            document.querySelector(".location").textContent =
                selectedValue === "#" || selectedValue === ""
                    ? "선택된 정보 없음"
                    : selectedText;

            if (selectedValue !== "#") {
                getLatAndLon(selectedValue);
            }
        }

        // 지역 위도와 경도를 가져오는 api 요청 함수
        async function getLatAndLon(city) {
            try {
                const response = await fetch(
                    `http://api.openweathermap.org/geo/1.0/direct?q=${city}&appid=${API_KEY}`
                );
                const data = await response.json();

                if (data.length === 0) {
                    alert("위치 정보를 찾을 수 없습니다.");
                    return;
                }

                const { lat, lon } = data[0];
                console.log("위도:", lat, "경도:", lon);
                getMainWeather(lat, lon);
            } catch (error) {
                console.error(error);
            }
        }

        // 지역의 중요 날씨 정보들을 가져오는 api 요청 함수
        async function getMainWeather(lat, lon) {
            try {
                const response = await fetch(
                    `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric`
                );
                const datas = await response.json();
                const temp = datas.main.temp;
                const wind = datas.wind.speed;
                const humidity = datas.main.humidity;
                const iconCode = datas.weather[0].icon;
                const iconUrl = `https://openweathermap.org/img/wn/${iconCode}@2x.png`;
                document.querySelector(".temp").textContent = `${temp}°C 도`;
                document.querySelectorAll(
                    ".info"
                )[0].textContent = `풍속 ${wind} m/s`;
                document.querySelectorAll(
                    ".info"
                )[1].textContent = `습도 ${humidity}%`;
                document.querySelector("#imgid").src = iconUrl;
            } catch (error) {
                console.error(error);
            }
        }
    </script>
</body>

</html> mn,