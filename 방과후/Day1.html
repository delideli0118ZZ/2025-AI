<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
        }

        .wrap {
            margin: 0 auto;
            width: 1000px;
        }

        /* 헤더 검색 부분 */
        header {
            text-align: center;
            padding: 25px;
            display: flex;
            justify-content: center;
        }

        .search {
            width: 350px;
            height: 50px;
            border-radius: 25px;
            border: 3px solid rgb(255, 28, 142);
            margin-right: 20px;
            padding: 20px;
        }

        .button {
            width: 80px;
            height: 50px;
            border-radius: 15px;
            background-color: hotpink;
            color: white;
            font-size: 19px;
            font-weight: 700;
            border: none;
        }

        /* 전적 요약 부분 */
        .profile {
            background-color: #eee;
            padding: 20px;
            margin-bottom: 20px;
        }

        .name {
            display: flex;
            border-bottom: 5px solid white;
        }

        .name-left {
            position: relative;
        }

        .name-left .profile-img {
            width: 150px;
        }

        .name-left .profile-level {
            position: absolute;
            bottom: -5px;
            left: 55px;
            background-color: hotpink;
            color: white;
            text-align: center;
            padding: 5px;
        }

        .information {
            display: flex;
            justify-content: space-between;
        }

        .information .left .death {
            color: #f00;
        }

        .information .left .kda {
            font-size: 20pt;
            font-weight: 900;
        }

        /* 20개 게임들 */
        .games .win {
            background-color: rgb(218, 235, 254);
            border-left: 5px solid blue;
        }

        .games .lose {
            background-color: rgb(255, 208, 208);
            border-left: 5px solid red;
        }

        .game {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            text-align: center;
            width: 1000px;
            margin: 0 auto;
            margin-bottom: 20px;
        }

        .center {
            text-align: left;
            width: 400px;
        }

        .center2 {
            text-align: center;
        }

        .games .center img {
            width: 30px;
        }

        .game .center2 .kda {
            font-size: 13pt;
            font-weight: 900;
        }

        .game .center2 .kda .death {
            color: #f00;
        }

        .game .center2 .rate {
            color: #888;
        }

        .game .center2 .cs {
            color: #888;
        }

        .team1 {
            width: 120px;
            text-align: left;
            font-size: 13px;
        }

        .team1 img {
            width: 15px;
        }

        .team2 {
            width: 120px;
            text-align: left;
            font-size: 13px;
        }

        .team2 img {
            width: 15px;
        }

        .right {
            display: flex;
        }

        .button:hover {
            cursor: pointer;
        }
    </style>
</head>

<body>



    <div class="wrap">
        <!-- 검색바 -->
        <header>
            <!-- 1. 검색바 -->
            <input type="text" class="search" value="4별비#5742" />
            <!-- 2. 검색 버튼 -->
            <button class="button">검색</button>
        </header>

        <!-- 전적 요약 부분 -->
        <div class="profile">
            <div class="name">
                <div class="name-left">
                    <img src="https://i.namu.wiki/i/uaovqDxjMYpv4bdjsVuXIG8d_LSrUT2X62msfbJqeUaRGaDXTN_jErNr2ooK9fwWjPFIJe0GVgsm0lGsKnLjLw.webp"
                        alt="" class="profile-img" />
                    <span class="profile-level">520</span>
                </div>
                <div class="name-right">
                    <h1>?</h1>
                    <div>
                        <img style="width: 100px" class="tier"
                            src="https://support-leagueoflegends.riotgames.com/hc/article_attachments/36727017636627"
                            alt="" />
                    </div>
                    승률 <span class="rate">100%</span> / <span class="win">100</span>승
                    <span class="lose">0</span>패
                </div>
            </div>
            <div class="information">
                <div class="left">
                    승률 <span class="rate">100</span>% <span class="win">20</span> 승
                    <span class="lose">0</span> 패
                    <br />
                    <span class="kill">10</span> / <span class="death">4</span> /
                    <span class="assist">10</span>
                    <br />
                    <span class="kda">5</span>
                </div>
                <div class="center">
                    <h2>최근 챔피언</h2>
                    <p>렉사이</p>
                </div>
                <div class="right">
                    탑 <span class="top">4</span> 정글
                    <span class="jungle">4</span> 미드 <span class="mid">4</span> 윈딜
                    <span class="bottom">4</span> 서폿 <span class="sup">4</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 20개 게임들 -->
    <div class="games">

    </div>

    <div class="games">
        
    </div>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        const API_KEY = "RGAPI-88e895dd-813b-47fb-b70c-b3a037cc40a3";
        let puuid;

        const 검색창 = document.querySelector(".search");

        // 1. ACCOUNT-V1에서 puuid 불러오기

        const 검색버튼 = document.querySelector(".button");
        검색버튼.addEventListener("click", async function () {
            // 1.ACCOUNT-V1에서 puuid 불러오기 / input에 입력한 내가 원하는 유저의 puuid

            let id = 검색창.value.split("#")[0];
            let tag = 검색창.value.split("#")[1];

            // "https://asia.api.riotgames.com/riot/account/v1/accounts/by-riot-id/4별비/5742?api_key=RGAPI-47184fa1-71bf-45fc-a7e6-60aa46a3f546"
            await axios
                .get(
                    `https://asia.api.riotgames.com/riot/account/v1/accounts/by-riot-id/${id}/${tag}?api_key=${API_KEY}`
                )
                .then(function (response) {
                    puuid = response.data.puuid;
                    console.log(response);
                    console.log(puuid);

                    const 이름지정 = document.querySelector(".name-right h1");
                    이름지정.textContent =
                        response.data.gameName + "#" + response.data.tagLine;
                })
                .catch(function (error) {
                    console.log("에러남");
                });

            // 2. SUMMONER-V4에서 소환사 정보 불러오기 (레벨, 프사)

            //`https://kr.api.riotgames.com/lol/summoner/v4/summoners/by-puuid/80gGBiRgEdl5cFSpS1_DujVFLeZTzxpBTveUPY0jyDoT85OLS7dTQvVc2l9uYCMAlXHSJAIZigSP3w?api_key=${API_KEY}`
            await axios
                .get(
                    `https://kr.api.riotgames.com/lol/summoner/v4/summoners/by-puuid/${puuid}?api_key=${API_KEY}`
                )
                .then(function (response) {
                    console.log(response);
                    let 소환사레벨 = response.data.summonerLevel;
                    let 프사번호 = response.data.profileIconId;
                    console.log(소환사레벨);
                    console.log(프사번호);
                    const 레벨지정 = document.querySelector(".profile-level");
                    레벨지정.textContent = 소환사레벨;
                    const 프사지정 = document.querySelector(".profile-img");
                    프사지정.setAttribute(
                        "src",
                        `https://opgg-static.akamaized.net/meta/images/profile_icons/profileIcon${프사번호}.jpg`
                    );
                })
                .catch(function (error) {
                    console.log("에러남");
                });

            //`https://kr.api.riotgames.com/lol/league/v4/entries/by-puuid/80gGBiRgEdl5cFSpS1_DujVFLeZTzxpBTveUPY0jyDoT85OLS7dTQvVc2l9uYCMAlXHSJAIZigSP3w?api_key=${API_KEY}`
            // 3. LEAGUE-V4에서 랭겜 정보 불러오기(랭크, 승, 패)
            await axios
                .get(
                    `https://kr.api.riotgames.com/lol/league/v4/entries/by-puuid/${puuid}?api_key=${API_KEY}`
                )
                .then(function (response) {
                    console.log(response);
                    const 랭크이미지 = document.querySelector(".tier"); // 랭크이미지 변경
                    랭크이미지.src = `https://opgg-static.akamaized.net/images/medals_new/${response.data[0].tier.toLowerCase()}.png`;

                    const 승 = document.querySelector(".win");
                    const 패 = document.querySelector(".lose");
                    const 승률 = document.querySelector(".rate");

                    승.textContent = response.data[0].wins;
                    패.textContent = response.data[0].losses;
                    승률.textContent =
                        (
                            response.data[0].wins /
                            (response.data[0].wins + response.data[0].losses)
                        ).toFixed(2) *
                        100 +
                        "%";
                })
                .catch(function (error) {
                    console.log("에러남");
                });

            게임20개();
        });
        let 승리횟수 = 0
        let 패배횟수 = 0
        let 킬 = 0
        let 데스 = 0
        let 어시 = 0
        let 탑 = 0
        let 정글 = 0
        let 미드 = 0
        let 바텀 = 0
        let 서폿 = 0
        let 최근챔 = ""

        async function 게임20개() {
            // 4-1 MATCH-V5에서 게임 20개 정보 불러오기
            //`https://asia.api.riotgames.com/lol/match/v5/matches/by-puuid/80gGBiRgEdl5cFSpS1_DujVFLeZTzxpBTveUPY0jyDoT85OLS7dTQvVc2l9uYCMAlXHSJAIZigSP3w/ids?start=0&count=20&api_key=${API_KEY}`

            await axios
                .get(
                    `https://asia.api.riotgames.com/lol/match/v5/matches/by-puuid/${puuid}/ids?start=0&count=20&api_key=${API_KEY}`
                )
                .then(async function (response) {
                    let 게임들 = response.data;

                    // 20개 게임 누적 방지를 위한 부모 초기화
                    const 부모 = document.querySelector(".games")
                    부모.innerHTML = '';
                    최근챔.textContent="";
                    for (let i = 0; i < 20; i = i + 1) {
                        await 게임분석(게임들[i]);
                    }
                    const 게임20개승률 = document.querySelector(".information .left .rate")
                    const 게임20개승리 = document.querySelector(".information .left .win")
                    const 게임20개패배 = document.querySelector(".information .left .lose")
                    const 게임20개평점 = document.querySelector(".information .left .kda")
                    게임20개승률.textContent = ((승리횟수 / (승리횟수+패배횟수))*100).toFixed(2)
                    게임20개승리.textContent = 승리횟수
                    게임20개패배.textContent = 패배횟수
                    
                    const 게임20개킬 = document.querySelector(".information .left .kill")
                    const 게임20개데스 = document.querySelector(".information .left .death")
                    const 게임20개어시 = document.querySelector(".information .left .assist")
                    게임20개킬.textContent = 킬
                    게임20개데스.textContent = 데스
                    게임20개어시.textContent = 어시
                    게임20개평점.textContent = ((킬+어시)/데스).toFixed(2) + " : 1"

                    const 게임20개탑 = document.querySelector(".right .top")
                    const 게임20개정글 = document.querySelector(".right .jungle")
                    const 게임20개미드 = document.querySelector(".right .mid")
                    const 게임20개바텀 = document.querySelector(".right .bottom")
                    const 게임20개서폿 = document.querySelector(".right .sup")
                    게임20개탑.textContent=탑
                    게임20개정글.textContent=정글
                    게임20개미드.textContent=미드
                    게임20개바텀.textContent=바텀
                    게임20개서폿.textContent=서폿

                    const 게임20개챔피언 = document.querySelector(".center p")
                    게임20개챔피언.textContent = 최근챔

                })
                .catch(function (error) {
                    console.log("에러남");
                });
        }

        // 4-2 매치 정보 불러오기
        async function 게임분석(게임id) {
            console.log(게임id, "분석");
            await axios
                .get(
                    `https://asia.api.riotgames.com/lol/match/v5/matches/${게임id}?api_key=${API_KEY}`
                )
                .then(function (response) {
                    console.log(response);

                    let 내번호
                    
                    for(let i=0; i<10; i=i+1){
                        if (response.data.info.participants[i].puuid == puuid) {
                            내번호 = i
                            console.log(내번호)
                        }
                    }

                    const 부모 = document.querySelector(".games");

                    let 게임 = document.createElement("div");
                    게임.classList.add("game");
                    
                    let 승리여부
                    if (response.data.info.participants[내번호].win){
                        게임.classList.add("win")
                        승리여부 = "승리"
                        승리횟수 = 승리횟수 + 1
                    }
                    else {
                        게임.classList.add("lose")
                        승리여부 = "패배"
                        패배횟수 = 패배횟수 + 1
                    }

                    킬 = 킬 + response.data.info.participants[내번호].kills
                    데스 = 데스 + response.data.info.participants[내번호].deaths
                    어시 = 어시 + response.data.info.participants[내번호].assists
                    
                    if(response.data.info.participants[내번호].teamPosition == "TOP") { 탑 = 탑 + 1 }
                else if(response.data.info.participants[내번호].teamPosition == "JUNGLE") { 정글 = 정글 + 1 }
                else if(response.data.info.participants[내번호].teamPosition == "MID") { 미드 = 미드 + 1 }
                else if(response.data.info.participants[내번호].teamPosition == "BOTTOM") { 바텀 = 바텀+1 }
                else if(response.data.info.participants[내번호].teamPosition == "UTILITY") { 서폿 = 서폿+1 }

                    최근챔 = 최근챔 + response.data.info.participants[내번호].championName + " "

                    게임.innerHTML = `
                    <div class="left">
                        <p class="queue">${response.data.info.gameMode}</p>
                        <p class="sp">${승리여부}</p>
                    </div>
                    <div class="center">
                        <img style="width: 70px; border-radius: 15px" class="champion"  src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/champion/${response.data.info.participants[내번호].championName}.png" alt="">
                        <span class="level">level ${response.data.info.participants[내번호].champLevel}</span>
                        <img style="width: 50px;"   src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/perk/${response.data.info.participants[내번호].perks.styles[0].selections[0].perk}.png" alt="">
                        <img style="width: 50px;"   src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/perkStyle/${response.data.info.participants[내번호].perks.styles[1].style}.png" alt="">
                        <img style="width: 50px"
                        src="https://cdn.lol.ps/assets/img/spells/${response.data.info.participants[내번호].summoner1Id}_40.webp"
                        alt="" />
                        <img style="width: 50px;"   src="https://cdn.lol.ps/assets/img/spells/${response.data.info.participants[내번호].summoner2Id}_40.webp" alt="">
                        <span class="multikill">펜타킬</span>

                    <div class="items">
                        <img src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/item/${response.data.info.participants[내번호].item0}.png" alt="" class="item1">
                        <img src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/item/${response.data.info.participants[내번호].item1}.png" alt="" class="item2">
                        <img src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/item/${response.data.info.participants[내번호].item2}.png" alt="" class="item3">
                        <img src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/item/${response.data.info.participants[내번호].item3}.png" alt="" class="item4">
                        <img src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/item/${response.data.info.participants[내번호].item4}.png" alt="" class="item5">
                        <img src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/item/${response.data.info.participants[내번호].item5}.png" alt="" class="item6">
                    </div>
                    </div>

                    <div class="center2">
                        <p class="kda">
                            <span class="kill">${response.data.info.participants[내번호].kills}</span> / <span class="death">${response.data.info.participants[내번호].deaths}</span> / <span class="assist">${response.data.info.participants[내번호].assists}</span>
                        </p>
                        <p class="rate">
                            <span class="rate2">평점${((response.data.info.participants[내번호].kills + response.data.info.participants[내번호].assists) / response.data.info.participants[내번호].deaths).toFixed(2)}</span>
                        </p>
                        <span class="cs">${response.data.info.participants[내번호].totalMinionsKilled} cs</span>
                    </div>
                    <div class="right">
                        <div class="team1">
                            <p><img src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/champion/${response.data.info.participants[0].championName}.png" alt=""><span>${response.data.info.participants[0].riotIdGameName}</span></p>
                            <p><img src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/champion/${response.data.info.participants[1].championName}.png" alt=""><span>${response.data.info.participants[1].riotIdGameName}</span></p>
                            <p><img src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/champion/${response.data.info.participants[2].championName}.png" alt=""><span>${response.data.info.participants[2].riotIdGameName}</span></p>
                            <p><img src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/champion/${response.data.info.participants[3].championName}.png" alt=""><span>${response.data.info.participants[3].riotIdGameName}</span></p>
                            <p><img src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/champion/${response.data.info.participants[4].championName}.png" alt=""><span>${response.data.info.participants[4].riotIdGameName}</span></p>
                        </div>
                        <br>
                        <div class="team2">
                            <p><img src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/champion/${response.data.info.participants[5].championName}.png" alt=""><span>${response.data.info.participants[5].riotIdGameName}</span></p>
                            <p><img src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/champion/${response.data.info.participants[6].championName}.png" alt=""><span>${response.data.info.participants[6].riotIdGameName}</span></p>
                            <p><img src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/champion/${response.data.info.participants[7].championName}.png" alt=""><span>${response.data.info.participants[7].riotIdGameName}</span></p>
                            <p><img src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/champion/${response.data.info.participants[8].championName}.png" alt=""><span>${response.data.info.participants[8].riotIdGameName}</span></p>
                            <p><img src="https://opgg-static.akamaized.net/meta/images/lol/15.15.1/champion/${response.data.info.participants[9].championName}.png" alt=""><span>${response.data.info.participants[9].riotIdGameName}</span></p>
                    </div>
                </div>
                    `;
                    부모.appendChild(게임)

                })
                .catch(function (error) {
                    console.log("에러남");
                });
            console.log(게임id, "분석완료");
        }
        // puuid": "80gGBiRgEdl5cFSpS1_DujVFLeZTzxpBTveUPY0jyDoT85OLS7dTQvVc2l9uYCMAlXHSJAIZigSP3w
        // "profileIconId": 6502,
        /* [
        "KR_7742626014",
        "KR_7742612804",
        "KR_7742610310",
        "KR_7740819804",
        "KR_7740784964",
        "KR_7738772609",
        "KR_7738720493",
        "KR_7736473208",
        "KR_7736451618",
        "KR_7735302762",
        "KR_7735255999",
        "KR_7735208731",
        "KR_7735175148",
        "KR_7735131248",
        "KR_7735081368",
        "KR_7735042825",
        "KR_7735006081",
        "KR_7734950991",
        "KR_7734914244",
        "KR_7734880571"
        ]
          */
    </script>
</body>

</html>